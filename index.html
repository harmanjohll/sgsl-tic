<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Avatar Loader Debug (Dynamic Import)</title>
  <style>
    body { font-family:sans-serif; text-align:center; padding:2rem; margin:0 }
    .section { max-width:480px; margin:2rem auto; padding:1rem; border:1px solid #ccc; background:#fafafa }
    button { font-size:1rem; padding:.5rem 1rem; margin:.5rem }
    #debugAvatar { color: red; min-height:1.2em }
    #avatarContainer { width:400px; height:300px; margin:1rem auto; border:1px solid #666; background:#f0f0f0 }
  </style>
</head>
<body>

  <h1>ðŸ”§ Avatar Loader Debug</h1>
  <section class="section">
    <h2>Load a 3D Avatar</h2>
    <button id="loadMale">Load Male Avatar</button>
    <button id="loadFemale">Load Female Avatar</button>
    <p id="debugAvatar">(no test yet)</p>
    <div id="avatarContainer"></div>
  </section>

  <script>
  (function(){
    let scene, camera, renderer, model;

    function log(msg) {
      document.getElementById('debugAvatar').textContent = msg;
    }

    function initCanvas(THREE) {
      if (scene) return;
      const container = document.getElementById('avatarContainer');
      scene    = new THREE.Scene();
      scene.background = new THREE.Color(0xf0f0f0);
      camera   = new THREE.PerspectiveCamera(45, 400/300, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(400, 300);
      container.innerHTML = '';
      container.appendChild(renderer.domElement);

      const light = new THREE.DirectionalLight(0xffffff,1);
      light.position.set(1,1,1);
      scene.add(light);
      scene.add(new THREE.AmbientLight(0x404040));

      camera.position.set(0,1.5,3);
      camera.lookAt(0,1,0);

      (function animate(){
        requestAnimationFrame(animate);
        if (model) model.rotation.y += 0.01;
        renderer.render(scene,camera);
      })();
    }

    async function loadAvatar(sex) {
      log(`Starting ${sex} avatar loadâ€¦`);
      try {
        // Dynamically import Three.js and GLTFLoader as ES modules
        const THREE = await import('https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js');
        const { GLTFLoader } = await import('https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/loaders/GLTFLoader.js');

        initCanvas(THREE);
        if (model) scene.remove(model);

        const url = sex==='male'
          ? 'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/CesiumMan/glTF/CesiumMan.gltf'
          : 'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Fox/glTF/Fox.gltf';

        const loader = new GLTFLoader();
        const gltf = await new Promise((res, rej) =>
          loader.load(url, res, undefined, rej)
        );
        model = gltf.scene;
        model.scale.set(1,1,1);
        scene.add(model);
        log(`Loaded ${sex} avatar successfully!`);
      } catch (err) {
        console.error('Avatar load failed', err);
        log('Error loading avatar: ' + err.message);
      }
    }

    document.getElementById('loadMale').onclick   = ()=> loadAvatar('male');
    document.getElementById('loadFemale').onclick = ()=> loadAvatar('female');
  })();
  </script>
</body>
</html>
